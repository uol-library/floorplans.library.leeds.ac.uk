function a(e){if(canUseLocalStorage())try{var t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),1}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}function t(e){var t=localStorage.getItem(e);return t?(t=JSON.parse(t),(new Date).getTime()>t.expiry?(localStorage.removeItem(e),null):t.value):null}function l(r){var e;r.hasOwnProperty("key")&&r.hasOwnProperty("url")&&(r.hasOwnProperty("expires")||(r.expires=24),a("localStorage")&&t(r.key)?(n("getting data '"+r.key+"' from local storage"),r.hasOwnProperty("callback")&&"function"==typeof r.callback&&r.callback(JSON.parse(t(r.key)))):(n("getting data '"+r.key+"' from "+r.url),(e=new XMLHttpRequest).addEventListener("load",function(){var e,t,o;a("localStorage")&&(e=(new Date).getTime()+60*r.expires*60*1e3,n("storing data '"+r.key+"' in localstorage - expires "+e),e=r.key,t=this.responseText,o=r.expires,t={value:t,expiry:(new Date).getTime()+60*o*60*1e3},localStorage.setItem(e,JSON.stringify(t))),r.hasOwnProperty("callback")&&"function"==typeof r.callback&&r.callback(JSON.parse(this.responseText))}),e.open("GET",r.url),e.send()))}function n(e){var t;floorplans.conf.debug&&(t=new Date,console.log(t.getHours()+":"+t.getMinutes().toString().padStart(2,"0")+":"+t.getSeconds().toString().padStart(2,"0")+"."+t.getMilliseconds().toString().padStart(3,"0")+" "+e))}"use strict";var e,o;e=this,o=function(){function r(e,t){return e<t?-1:t<e?1:0}function e(e,t){if(void 0===t&&(t=r),this.data=e=void 0===e?[]:e,this.length=this.data.length,this.compare=t,0<this.length)for(var o=(this.length>>1)-1;0<=o;o--)this._down(o)}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){var e;if(0!==this.length)return e=this.data[0],this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,o=this.compare,r=t[e];0<e;){var a=e-1>>1,l=t[a];if(0<=o(r,l))break;t[e]=l,e=a}t[e]=r},e.prototype._down=function(e){for(var t=this.data,o=this.compare,r=this.length>>1,a=t[e];e<r;){var l=1+(e<<1),n=l+1,i=t[l];if(n<this.length&&o(t[n],i)<0&&(i=t[l=n]),0<=o(i,a))break;t[e]=i,e=l}t[e]=a},e},"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Queue=o(),canUseLocalStorage=function(){return!1},document.addEventListener("DOMContentLoaded",function(){floorplans.map=new L.Map("floorplan",{crs:L.CRS.Simple,zoom:floorplans.imgconf.startZoom,center:[floorplans.imgconf.startLat,floorplans.imgconf.startLng],minZoom:floorplans.imgconf.minZoom,maxZoom:floorplans.imgconf.maxZoom,zoomControl:!1}),floorplans.map.attributionControl.setPrefix('<a href="https://leafletjs.com" target="external" title="A JavaScript library for interactive maps" aria-label="Leaflet - a JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a>'),L.control.zoom({position:"topright"}).addTo(floorplans.map),floorplans.imagelayers.forEach(e=>{e.floors.forEach(e=>{floorplans.maxHeight=Math.max(floorplans.maxHeight,e.height),floorplans.maxWidth=Math.max(floorplans.maxWidth,e.width)})}),floorplans.mapBounds=new L.LatLngBounds(floorplans.map.unproject([0,floorplans.maxHeight],floorplans.imgconf.maxZoom),floorplans.map.unproject([floorplans.maxWidth,0],floorplans.imgconf.maxZoom)),floorplans.conf.debug&&floorplans.map.on("click",function(e){console.log(e.latlng.lng+", "+e.latlng.lat)}),x(),r(),document.dispatchEvent(new Event("fpmapready"))});var i=function(r){return r.floorlayer?new Promise((e,t)=>{n("addFloorLayer - floor layer already present for "+r),e(r.floorlayer)}):new Promise((o,e)=>{var t=new Image;r.imageBounds=L.latLngBounds(floorplans.map.unproject([0,0],floorplans.imgconf.maxZoom),floorplans.map.unproject([r.width,r.height],floorplans.imgconf.maxZoom)),t.onload=function(){n("addFloorLayer - image loaded for "+r.floorname);var e=L.imageOverlay(r.imageurl,r.imageBounds);let t=L.layerGroup([e]);l({url:r.dataurl,key:r.floorid,callback:function(e){r.selecters={},r.iconlayer=L.layerGroup(),n("addFloorLayer - GeoJSON loaded for "+r.floorname),r.features=L.geoJSON(e,{onEachFeature:function(e,t){t.id=e.properties.type+e.id;let o=!!e.properties.hasOwnProperty("icon")&&e.properties.icon;"location"===e.properties.type&&o&&t._latlngs.forEach(e=>{var e=L.polygon(e).getBounds().getCenter(),e=floorplans.map.latLngToContainerPoint(e),t=e.add({x:-2.5,y:-2.5}),e=e.add({x:2.5,y:2.5}),t=L.latLngBounds(floorplans.map.containerPointToLatLng(t),floorplans.map.containerPointToLatLng(e));r.iconlayer.addLayer(L.svgOverlay(h(o),t))}),r.selecters.hasOwnProperty(e.properties.type)||(r.selecters[e.properties.type]=[]),r.selecters[e.properties.type].push({value:t.id,label:e.properties.name,desc:e.properties.desc,icon:o,class:e.properties.class}),"area"===e.properties.type?t.bindTooltip(c(e),{className:"area-tooltip"}):t.bindPopup(c(e),{className:"feature-tooltip"}),t.on({mouseover:f,focus:f,mouseout:u,blur:u})},style:function(e){return{weight:0,opacity:0,fillOpacity:"area"!==e.properties.type?.5:.2,className:e.properties.class}}}),t.addLayer(r.features),t.addLayer(r.iconlayer),n("Added shelves, features for "+r.floorname),r.floorlayer=t,o(t)}})},t.src=r.imageurl})};function c(e){let t="<strong>"+e.properties.name+"</strong>";return e.properties.desc&&""!==e.properties.desc&&(t+="<br>"+e.properties.desc),t}function r(){let o=m(),r=!1;o.floorid&&floorplans.imagelayers.forEach(e=>{e.floors.forEach(t=>{t.floorid===o.floorid&&(r=!0,i(t).then(e=>{S(t),E(t),e.addTo(floorplans.map),floorplans.map.fitBounds(t.imageBounds),floorplans.map.setView(t.imageBounds.getCenter()),p(o.floorid),d(t,o.shelfname),O(o.floorid),floorplans.imagelayers.forEach(e=>{e.floors.forEach(e=>{i(e)})})}))})}),r||floorplans.imagelayers.forEach(e=>{e.floors.forEach(e=>{i(e)})})}function p(e){var t=document.getElementById("floorselecter");if(t)for(var o=0;o<t.options.length;o++)t.options[o].value===e&&(t.options[o].selected=!0)}function d(e,t){e.selecters.shelf.forEach(e=>{e.label.match(t)&&C(e.value)})}function f(e){u();var t=e.target;if(t.id){if(t.id.startsWith("area"))return floorplans.map.closePopup(),t.openTooltip(),void t.setStyle({fillOpacity:.4,opacity:1});t.setStyle({fillOpacity:.75,opacity:1})}t.feature&&t.feature.geometry&&t.feature.geometry.coordinates&&1<t.feature.geometry.coordinates.length&&e.latlng?t.openPopup(e.latlng):t.openPopup()}function u(){floorplans.currentFloor&&floorplans.currentFloor.features&&floorplans.currentFloor.features.eachLayer(function(e){e.id&&(e.id.startsWith("area")?e.setStyle({fillOpacity:.2,opacity:0}):e.setStyle({fillOpacity:.5,opacity:0}))})}function h(e){var t;return!!floorplans.icons.hasOwnProperty(e)&&((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("viewBox",floorplans.icons[e].viewBox),t.innerHTML=floorplans.icons[e].path,t)}function m(){var t={library:!1,floorid:!1,shelfid:!1,shelfname:!1,classmark:!1,search:!1,path:!1};if(window.location.search){var o,r=new URLSearchParams(window.location.search);t.search=r.toString();let e=!1;r.has("path")&&(o=r.get("path").split("/"),(t.path=o).length&&"floorplan"===o[0]?r.has("library")&&(t.library=y(r.get("library")),t.library)&&("health-sciences"===t.library?t.floorid="health-sciences":r.has("floor")&&(t.floorid=g(r.get("floor")),e=t.floorid.split("-").pop())):2<=o.length&&"floors"===o[1]&&(t.library=o[0],3<=o.length)&&(e=o[2],"brotherton"===t.library?-1!==["m1","m2","m3","m4","w2","w3"].indexOf(e)&&(t.floorid=t.library+"-"+e):"edwardboyle"===t.library?8<=parseInt(e)&&parseInt(e)<=13&&(t.floorid=t.library+"-"+e):"healthsciences"===t.library?t.floorid="health-sciences":"laidlaw"===t.library&&-1!==["ground","first","second","third"].indexOf(e)&&(t.floorid=t.library+"-"+e))),r.has("classmark")&&(t.classmark=D(r.get("classmark"),t),o=b(t.library,e,t.classmark))&&(t.floorid||(t.floorid=o.floorid),t.shelfid=o.featureid,t.shelfname=o.name)}else""!==window.location.hash&&("health-sciences"===(r=window.location.hash.substring(1).split("/"))[0]?(t.library="health-sciences",t.floorid="health-sciences"):t.library=r[0],1<r.length)&&("health-sciences"===t.library?t.shelfname=r[1]:(t.floorid=r[0]+"-"+r[1],2<r.length&&(t.shelfname=r[2])));return t}function y(e){var t={LL:"laidlaw",BL:"brotherton",EBL:"edwardboyle",HSL:"health-sciences"};return!!t.hasOwnProperty(e)&&t[e]}function g(e){var t={llhdc:"laidlaw-ground",ll1:"laidlaw-first",ll2:"laidlaw-second",ll3:"laidlaw-third",blmic:"brotherton-m1",blm1:"brotherton-m1",blm2:"brotherton-m2",blm3:"brotherton-m3",blm4:"brotherton-m4",blw2:"brotherton-w2",blw2a:"brotherton-w2",blw3:"brotherton-w3",ebl8:"edwardboyle-8",ebl9:"edwardboyle-9",ebl10:"edwardboyle-10",ebl11:"edwardboyle-11",ebl12:"edwardboyle-12",ebl13:"edwardboyle-13"};return!!t.hasOwnProperty(e)&&t[e]}function b(o,e,r){var a=getFeatures();let l=!1;for(let t=0;t<a.length;t++){var n=w(o,e);if(a[t][1].match(n)){n=v(a[t][0]);let e=!1;if("health-sciences"===o?r===a[t][0]&&(e=a[t][1].split("-")):r.match(n)&&(e=a[t][1].split("-")),e){l={name:a[t][0],library:e[0],floorid:e[0]+"-"+e[1],featureid:"shelf-"+e[2]};break}}}return l}function v(e){return"^"+(e=-1!==(e=e.replaceAll("/([|])/","")).indexOf(", ")?"("+e.split(", ").join("|")+")":e)+".*$"}function w(e,t){return t?"^"+e+"-"+t+".*$":"^"+e+".*$"}function D(e,t){if((e=decodeURIComponent(e)).match("^Video"))return"DVD";if(e.match("Atlas Case"))return"Atlases";if(e.match("([a-zA-Z ]+) A-0.01"))return e.match("([a-zA-Z ]+) A-0.01")[1]+" Journals";if(t.floorid)switch(t.floorid){case"brotherton-w2":if(e.match("Large .*")||e.match("Newspapers"))return"All Large Journals & Foreign Newspapers";if(e.match("Stack Large"))return"All Stack Large A-Z";break;case"brotherton-w3":if(e.match(" A-0.01"))return"Current Periodicals";break;case"health-sciences":if(e.match("Pamphlet"))return"Pamphlets";var o=e.match(/.* (Abstract|AVC|BF|BL|BM|GN|HM|HV|Pamphlets|Periodicals|Psychology|QA|QB|QC|QD|QH|QL|QP|QS|QT|QU|QV|QW|QY|QZ|Reference|Requested Items|Statistics|WA|WB|WC|WD|WE|WF|WG|WH|WI|WJ|WK|WL|WM|WN|WO|WP|WQ|WR|WS|WT|WU|WV|WW|WX|WY|WZ|Q|Z|W) .*/);if(null!==o)return o[1]}return e}function x(){floorplans.controlsContainer=L.DomUtil.get("floorplan-controls");L.DomUtil.create("h2","floorplans-selecter-header",floorplans.controlsContainer).textContent="Library Floorplans Navigation";var e=L.DomUtil.create("fieldset","floorplans-selecter",floorplans.controlsContainer),e=(L.DomUtil.create("legend","floorplans-selecter-legend visuallyhidden",e).textContent="Floorplan controls",floorplans.controls=L.DomUtil.create("div","floorplans-selecter-content",e),floorplans.controls.setAttribute("id","floorplans-selecter-controls"),L.DomUtil.create("label","selecter__label",floorplans.controls));e.textContent="Select a Library / floor",e.setAttribute("id","floorselecterlabel"),e.setAttribute("for","floorselecter");let t=L.DomUtil.create("select","selecter__select",floorplans.controls);t.setAttribute("id","floorselecter");L.DomUtil.create("option","",t).textContent="Select a Library / floor",floorplans.imagelayers.forEach(e=>{let o=L.DomUtil.create("optgroup","",t);o.setAttribute("label",e.title),e.floors.forEach(e=>{var t=L.DomUtil.create("option","",o);t.textContent=e.floorname,t.setAttribute("value",e.floorid)})});e=L.DomUtil.create("div","hidden",floorplans.controls);e.setAttribute("id","areaselecter"),L.DomUtil.create("h3","",e).textContent="Study Areas";L.DomUtil.create("ul","selecter__list",e).setAttribute("id","areaselecterlist");e=L.DomUtil.create("div","hidden",floorplans.controls);e.setAttribute("id","shelfselecter"),L.DomUtil.create("h3","",e).textContent="Subjects on this floor";L.DomUtil.create("ul","selecter__list",e).setAttribute("id","shelfselecterlist");e=L.DomUtil.create("div","hidden",floorplans.controls);e.setAttribute("id","locationselecter"),L.DomUtil.create("h3","",e).textContent="Also on this floor";L.DomUtil.create("ul","selecter__list",e).setAttribute("id","locationselecterlist"),L.DomEvent.on(t,"change",function(){""!==this.options[this.selectedIndex].value&&(floorplans.map.eachLayer(function(e){floorplans.map.removeLayer(e)}),["areaselecter","shelfselecter","locationselecter"].forEach(e=>{var t=L.DomUtil.get(e+"list");t&&t.hasChildNodes()&&L.DomUtil.empty(t),L.DomUtil.addClass(L.DomUtil.get(e),"hidden")}),floorplans.imagelayers.forEach(e=>{e.floors.forEach(t=>{t.floorid==this.options[this.selectedIndex].value&&i(t).then(e=>{S(t),E(t),e.addTo(floorplans.map),floorplans.currentFloor=t,floorplans.map.fitBounds(t.imageBounds),floorplans.map.setView(t.imageBounds.getCenter()),n("Added layer for floor "+t.floorname)})})}))});var o=document.getElementById("menu-close-button"),r=document.getElementById("floorplan-controls");o.addEventListener("click",e=>{o.classList.contains("close")?(o.classList.remove("close"),r.classList.add("closed")):(o.classList.add("close"),r.classList.remove("closed"))})}function S(e){for(s in e.selecters){var t=L.DomUtil.get(s+"selecter");let r=L.DomUtil.get(s+"selecterlist");e.selecters[s].length&&(e.selecters[s].forEach(e=>{var t=L.DomUtil.create("li","item-"+s,r);t.setAttribute("data-sortkey",e.label.toLowerCase().replace(/\W/g,"").replace(/(8|13)([1-9])$/,"$10$2"));let o=s+"button "+e.class;e.icon&&""!==e.icon&&(o+=" icon-"+e.icon);t=L.DomUtil.create("button",o,t);t.innerText=e.label,t.setAttribute("data-featureid",e.value),L.DomEvent.on(t,"focus mouseover",function(e){A(e.target.getAttribute("data-featureid")).fire("mouseover",{},!0)}),L.DomEvent.on(t,"blur mouseout",function(e){A(e.target.getAttribute("data-featureid")).fire("mouseout",{},!0)}),e.desc&&""!==e.desc&&!e.icon&&(t.title=e.desc)}),L.DomUtil.removeClass(t,"hidden"))}}function E(e){for(s in e.selecters){let t=L.DomUtil.get(s+"selecterlist"),o=[];t.querySelectorAll("li").forEach(e=>{o.push(e.getAttribute("data-sortkey"))}),o.sort(),o.forEach(e=>{e=t.querySelector('[data-sortkey="'+e+'"]');t.appendChild(e)})}}function A(t){let o=!1;return floorplans.map.eachLayer(e=>{e.id&&e.id===t&&(o=e)}),o}function C(e){var t=A(e);!1!==t&&(t.fire("mouseover",{},!0),t=document.querySelector('button[data-featureid="'+e+'"]'))&&t.focus()}function U(){n("updateOccupancy"),l({url:"https://floorplans.library.leeds.ac.uk/capacity.json",key:"libraryOccupancy",expires:.015,callback:function(e){for(lib in floorplans.occupancyData){var t,o,r;e.hasOwnProperty(lib)?(n("Updating occupancy for spaces in "+lib+" to "+e[lib].occupancy),floorplans.occupancyData[lib].occupancy=parseInt(e[lib].occupancy),floorplans.occupancyData[lib].capacity=parseInt(e[lib].capacity),t=document.querySelector("."+floorplans.occupancyData[lib].floorid+"msg"),o=floorplans.occupancyData[lib].occupancy<50?"fewer than 50":floorplans.occupancyData[lib].occupancy.toLocaleString("en"),r=floorplans.occupancyData[lib].capacity.toLocaleString("en"),t.innerHTML="There are currently <strong>"+o+"</strong> people in the <strong>"+lib+" library</strong>, which has a seating capacity of approximately <strong>"+r+"</strong>"):n("No occupancy data for "+lib)}}})}function O(o){var r=document.getElementById("occupancyContainer");if(o.match("(edward|laidlaw)")){r.classList.remove("hidden");let e,t;o.match("edward")?(e=document.querySelector(".edwardboylemsg"),t=document.querySelector(".laidlawmsg")):(t=document.querySelector(".edwardboylemsg"),e=document.querySelector(".laidlawmsg")),t.classList.add("hidden"),e.classList.remove("hidden")}else r.classList.add("hidden")}floorplans.occupancyData={"Edward Boyle":{floorid:"edwardboyle",capacity:1800,occupancy:0},Laidlaw:{floorid:"laidlaw",capacity:640,occupancy:0}},document.addEventListener("fpmapready",e=>{L.Control.Occupancy=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div","hidden");for(lib in t.setAttribute("id","occupancyContainer"),floorplans.occupancyData)L.DomUtil.create("p","hidden "+floorplans.occupancyData[lib].floorid+"msg",t);return t},onRemove:function(e){}}),L.control.occupancy=function(e){return new L.Control.Occupancy(e)},L.control.occupancy({position:"topleft"}).addTo(floorplans.map),U(),setInterval(U,6e4)}),document.addEventListener("DOMContentLoaded",()=>{L.DomEvent.on(floorselecter,"change",function(){document.getElementById("occupancyContainer");""!==this.options[this.selectedIndex].value&&O(this.options[this.selectedIndex].value)})});