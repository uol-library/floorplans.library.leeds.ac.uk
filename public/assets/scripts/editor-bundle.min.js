function r(e){if(canUseLocalStorage())try{var o=window[e],t="__storage_test__";return o.setItem(t,t),o.removeItem(t),1}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&o&&0!==o.length}}function o(e){var o=localStorage.getItem(e);return o?(o=JSON.parse(o),(new Date).getTime()>o.expiry?(localStorage.removeItem(e),null):o.value):null}function n(a){var e;a.hasOwnProperty("key")&&a.hasOwnProperty("url")&&(a.hasOwnProperty("expires")||(a.expires=24),r("localStorage")&&o(a.key)?(l("getting data '"+a.key+"' from local storage"),a.hasOwnProperty("callback")&&"function"==typeof a.callback&&a.callback(JSON.parse(o(a.key)))):(l("getting data '"+a.key+"' from "+a.url),(e=new XMLHttpRequest).addEventListener("load",function(){var e,o,t;r("localStorage")&&(e=(new Date).getTime()+60*a.expires*60*1e3,l("storing data '"+a.key+"' in localstorage - expires "+e),e=a.key,o=this.responseText,t=a.expires,o={value:o,expiry:(new Date).getTime()+60*t*60*1e3},localStorage.setItem(e,JSON.stringify(o))),a.hasOwnProperty("callback")&&"function"==typeof a.callback&&a.callback(JSON.parse(this.responseText))}),e.open("GET",a.url),e.send()))}function l(e){var o;floorplans.conf.debug&&(o=new Date,console.log(o.getHours()+":"+o.getMinutes().toString().padStart(2,"0")+":"+o.getSeconds().toString().padStart(2,"0")+"."+o.getMilliseconds().toString().padStart(3,"0")+" "+e))}"use strict";var e,t;e=this,t=function(){function a(e,o){return e<o?-1:o<e?1:0}function e(e,o){if(void 0===o&&(o=a),this.data=e=void 0===e?[]:e,this.length=this.data.length,this.compare=o,0<this.length)for(var t=(this.length>>1)-1;0<=t;t--)this._down(t)}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){var e;if(0!==this.length)return e=this.data[0],this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var o=this.data,t=this.compare,a=o[e];0<e;){var r=e-1>>1,n=o[r];if(0<=t(a,n))break;o[e]=n,e=r}o[e]=a},e.prototype._down=function(e){for(var o=this.data,t=this.compare,a=this.length>>1,r=o[e];e<a;){var n=1+(e<<1),l=n+1,i=o[n];if(l<this.length&&t(o[l],i)<0&&(i=o[n=l]),0<=t(i,r))break;o[e]=i,e=n}o[e]=r},e},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Queue=t(),canUseLocalStorage=function(){return!1},document.addEventListener("DOMContentLoaded",function(){floorplans.map=new L.Map("floorplan",{crs:L.CRS.Simple,zoom:floorplans.imgconf.startZoom,center:[floorplans.imgconf.startLat,floorplans.imgconf.startLng],minZoom:floorplans.imgconf.minZoom,maxZoom:floorplans.imgconf.maxZoom,zoomControl:!1}),floorplans.map.attributionControl.setPrefix('<a href="https://leafletjs.com" target="external" title="A JavaScript library for interactive maps" aria-label="Leaflet - a JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a>'),L.control.zoom({position:"topright"}).addTo(floorplans.map),floorplans.imagelayers.forEach(e=>{e.floors.forEach(e=>{floorplans.maxHeight=Math.max(floorplans.maxHeight,e.height),floorplans.maxWidth=Math.max(floorplans.maxWidth,e.width)})}),floorplans.mapBounds=new L.LatLngBounds(floorplans.map.unproject([0,floorplans.maxHeight],floorplans.imgconf.maxZoom),floorplans.map.unproject([floorplans.maxWidth,0],floorplans.imgconf.maxZoom)),floorplans.conf.debug&&floorplans.map.on("click",function(e){console.log(e.latlng.lng+", "+e.latlng.lat)}),L.Control.FloorSelecter=L.Control.extend({onAdd:function(e){var o=L.DomUtil.create("div","floorplan-controls");let a=L.DomUtil.create("select","selecter__select",o);a.setAttribute("id","floorselecter");var t=L.DomUtil.create("button","export__button",o);return t.setAttribute("id","exportbutton"),t.textContent="Export",L.DomUtil.create("option","",a).textContent="Select a Library / floor",floorplans.imagelayers.forEach(e=>{let t=L.DomUtil.create("optgroup","",a);t.setAttribute("label",e.title),e.floors.forEach(e=>{var o=L.DomUtil.create("option","",t);o.textContent=e.floorname,o.setAttribute("value",e.floorid)})}),o},onRemove:function(e){}}),L.control.floorselecter=function(e){return new L.Control.FloorSelecter(e)},L.control.floorselecter({position:"topleft"}).addTo(floorplans.map),L.DomEvent.on(floorselecter,"change",function(){""!==this.options[this.selectedIndex].value&&(floorplans.map.eachLayer(function(e){floorplans.map.removeLayer(e)}),floorplans.imagelayers.forEach(e=>{e.floors.forEach(o=>{o.floorid==this.options[this.selectedIndex].value&&a(o).then(e=>{e.addTo(floorplans.map),floorplans.map.fitBounds(o.imageBounds),floorplans.map.setView(o.imageBounds.getCenter()),l("Added layer for floor "+o.floorname)})})}))}),L.DomEvent.on(L.DomUtil.get("exportbutton"),"click",function(){let o=L.DomUtil.create("div","exchange-overlay",L.DomUtil.get("maincontainer"));var e=L.DomUtil.create("button","btn-menu close",o);e.setAttribute("id","menu-close-button"),L.DomUtil.create("span","icon",e),L.DomUtil.create("span","visuallyhidden",e).textContent="Close",e.addEventListener("click",e=>{L.DomUtil.remove(o)}),L.DomUtil.create("textarea","geojson-container",o).textContent=JSON.stringify(floorplans.map.pm.getGeomanLayers(!0).toGeoJSON(),null,4),L.DomUtil.toFront(o)}),floorplans.map.pm.addControls(),floorplans.map.pm.setGlobalOptions({snappable:!1}),document.dispatchEvent(new Event("fpmapready"))});var a=function(a){return a.floorlayer?new Promise((e,o)=>{l("addFloorLayer - floor layer already present for "+a),e(a.floorlayer)}):new Promise((t,e)=>{var o=new Image;a.imageBounds=L.latLngBounds(floorplans.map.unproject([0,0],floorplans.imgconf.maxZoom),floorplans.map.unproject([a.width,a.height],floorplans.imgconf.maxZoom)),o.onload=function(){l("addFloorLayer - image loaded for "+a.floorname);var e=L.imageOverlay(a.imageurl,a.imageBounds);let o=L.layerGroup([e]);n({url:a.dataurl,key:a.floorid,callback:function(e){a.selecters={shelf:[],location:[]},l("addFloorLayer - GeoJSON loaded for "+a.floorname),a.features=L.geoJSON(e,{onEachFeature:function(e,o){"shelf"==e.properties.type?(o.id="shelf"+e.id,a.selecters.shelf.push({value:o.id,label:e.properties.name,class:e.properties.class})):"location"==e.properties.type&&(o.id="location"+e.id,a.selecters.location.push({value:o.id,label:e.properties.name,class:e.properties.class})),o.bindPopup(e.properties.name,{className:"feature-tooltip"}),o.on({click:i,popupclose:s})},style:function(e){let o=.5;return{weight:0,opacity:0,fillOpacity:o="location"==e.properties.type?0:o,className:e.properties.class}}}),a.features.options.pmIgnore=!1,o.addLayer(a.features),l("Added shelf features for "+a.floorname),a.floorlayer=o,t(o)}})},o.src=a.imageurl})};function i(e){e=e.target;e.options.pmIgnore=!1,L.PM.reInitLayer(e)}function s(e){floorplans.map.eachLayer(e=>{e.options.pmIgnore=!0})}